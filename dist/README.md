# roaring-wasm

WebAssembly port of Roaring Bitmaps for NodeJS.

Roaring bitmaps are compressed bitmaps. They can be hundreds of times faster.

## motivation

This project was born to use Roaring WASM in AWS Lambdas without the need to compile a node-gyp module.
AWS Lambda supports node 8.10 and supports WASM.

## installation

```sh
npm install --save roaring-wasm
```

## references

This package - <https://www.npmjs.com/package/roaring-wasm>

Source code and build tools for this package - <https://github.com/SalvatorePreviti/roaring-wasm>

Roaring Bitmaps - <http://roaringbitmap.org/>

Portable Roaring bitmaps in C - <https://github.com/RoaringBitmap/CRoaring>

emscripten - <https://github.com/kripken/emscripten/wiki>

AWS Lambda - <https://docs.aws.amazon.com/lambda/latest/dg/nodejs-prog-model-handler.html>

# licenses

-   This package is provided as open source software using Apache License.

-   CRoaring is provided as open source software using Apache License.

# API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [RoaringTypedArray](#roaringtypedarray)
    -   [buffer](#buffer)
    -   [isDisposed](#isdisposed)
    -   [set](#set)
    -   [dispose](#dispose)
    -   [toArray](#toarray)
    -   [toString](#tostring)
-   [RoaringUint8Array](#roaringuint8array)
    -   [throwIfDisposed](#throwifdisposed)
-   [RoaringBitmap32](#roaringbitmap32)
    -   [xorCardinality](#xorcardinality)
    -   [isDisposed](#isdisposed-1)
    -   [dispose](#dispose-1)
    -   [throwIfDisposed](#throwifdisposed-1)
    -   [cardinality](#cardinality)
    -   [isEmpty](#isempty)
    -   [add](#add)
    -   [addMany](#addmany)
    -   [remove](#remove)
    -   [maximum](#maximum)
    -   [minimum](#minimum)
    -   [contains](#contains)
    -   [isSubset](#issubset)
    -   [isStrictSubset](#isstrictsubset)
    -   [toRoaringUint32Array](#toroaringuint32array)
    -   [toArray](#toarray-1)
    -   [equals](#equals)
    -   [flipRange](#fliprange)
    -   [optimize](#optimize)
    -   [select](#select)
    -   [andCardinality](#andcardinality)
    -   [orCardinality](#orcardinality)
    -   [andNotCardinality](#andnotcardinality)
    -   [andWith](#andwith)
    -   [orWith](#orwith)
    -   [xorWith](#xorwith)
    -   [andNotWith](#andnotwith)
    -   [rank](#rank)
    -   [intersects](#intersects)
    -   [jaccardIndex](#jaccardindex)
    -   [getSerializationSizeInBytesPortable](#getserializationsizeinbytesportable)
    -   [serializePortable](#serializeportable)
    -   [deserializePortable](#deserializeportable)
    -   [getSerializationSizeInBytesNative](#getserializationsizeinbytesnative)
    -   [serializeNative](#serializenative)
    -   [deserializeNative](#deserializenative)
-   [RoaringUint32Array](#roaringuint32array)

## RoaringTypedArray

Base class for typed arrays allocted directly in roaring library WASM memory.
Note: Memory is not garbage collected, you are responsible to free the allocated memory calling "dispose" method.

### buffer

The ArrayBuffer instance referenced by the array.
Note that the buffer may become invalid if the WASM allocated memory grows.
When the WASM grows the preallocated memory this property will return the new allocated buffer.
Use the returned buffer for short periods of time.

Type: [ArrayBuffer](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer)

### isDisposed

Returns true if this object was deallocated.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

### set

Writes the given array at the specified position

**Parameters**

-   `array`  A typed or untyped array of values to set.
-   `offset`  The index in the current array at which the values are to be written.

### dispose

Frees the allocated memory.
Is safe to call this method more than once.

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if memory gets freed during this call, false if not.

### toArray

Copies the content of this typed array into a standard JS array of numbers and returns it.

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** A new array.

### toString

Returns a string representation of an array.

## RoaringUint8Array

Array of bytes allocted directly in roaring library WASM memory.
Note: Memory is not garbage collected, you are responsible to free the allocated memory calling "dispose" method.

### throwIfDisposed

Throws an error if the memory was freed.

Returns **(void | never)** 

## RoaringBitmap32

A Roaring Bitmap that supports 32 bit unsigned integers.
The roaring bitmap allocates in WASM memory, remember to dispose
the RoaringBitmap32 when not needed anymore to release WASM memory.

### xorCardinality

Computes the size of the symmetric difference (xor) between two bitmaps.
Both bitmaps are unchanged.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Cardinality of the symmetric difference (xor) of two bitmaps.

### isDisposed

Returns true if this instance was disposed.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

### dispose

Disposes this object freeing all WASM memory associated to it.
Is safe to call this method more than once.

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if disposed during this call, false if not.

### throwIfDisposed

Throws an exception if this object was disposed before.

Returns **(void | never)** 

### cardinality

Get the cardinality of the bitmap (number of elements).

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Number of elements in this bitmap.

### isEmpty

Returns true if the bitmap has no elements.

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if the bitmap is empty.

### add

Adds a 32 bit unsigned integer value.
Values are unique, this function does nothing if the value already exists.

**Parameters**

-   `value` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 32 bit unsigned integer to add in the set.

### addMany

Adds multiple values.
Using this is faster than calling add() multiple times.
Inserting ordered or partialky ordered arrays is faster.

**Parameters**

-   `values` **[RoaringUint32Array](#roaringuint32array)** 

### remove

Removes a value from the set.
If the value does not exists, this function does nothing.

**Parameters**

-   `value` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The value to remove.

### maximum

Gets the maximum value stored in the bitmap.
If the bitmap is empty, returns 0.

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The maximum 32 bit unsigned integer or 0 if empty.

### minimum

Gets the minimum value stored in the bitmap.
If the bitmap is empty, returns 0xFFFFFFFF

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The minimum 32 bit unsigned integer or 0xFFFFFFFF if empty.

### contains

Checks whether the given value is contained in the set.

**Parameters**

-   `value` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The value to look for.

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if value exists in the set, false if not.

### isSubset

Returns true if the bitmap is subset of the other.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** the other bitmap

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

### isStrictSubset

Returns true if this bitmap is strict subset of the other.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** The other bitmap

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if this bitmap is a strict subset of other

### toRoaringUint32Array

Converts the bitmap to an array.
The array may be very big, use this function with caution.
The returned RoaringUint32Array is allocated in WASM memory and not garbage collected,
it need to be freed manually calling dispose().

Returns **[RoaringUint32Array](#roaringuint32array)** The RoaringUint32Array. Remember to manually dispose to free the memory.

### toArray

Converts the bitmap to a JS array.
The array may be very big, use this function with caution.

Returns **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** The array containing all values in the set.

### equals

Checks wether two roaring bitmap contains the same data.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if the bitmaps contains the same data, false if not.

### flipRange

Negates in place the bitmap within a specified interval.
Areas outside the range are passed through unchanged.

**Parameters**

-   `start` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Range start.
-   `end` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Range end.

### optimize

Optimizes the bitmap releasing unused memory and compressing containers.
Returns true if something changed.

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if something changed.

### select

If the size of the roaring bitmap is strictly greater than rank, then
this function returns the element of given rank.
Otherwise, it returns NaN.

**Parameters**

-   `rank` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Element rank

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** element or NaN

### andCardinality

Computes the size of the intersection between two bitmaps.
Both bitmaps are unchanged.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Cardinality of the intersection between two bitmaps.

### orCardinality

Computes the size of the union of two bitmaps.
Both bitmaps are unchanged.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Cardinality of the union of two bitmaps.

### andNotCardinality

Computes the size of the difference (andnot) of two bitmaps.
Both bitmaps are unchanged.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Cardinality of the difference (andnot) of two bitmaps.

### andWith

Intersects this bitmap with another.
Removes the elements from this bitmap that don't exists in the other.
Stores the result in this bitmap.
The provided bitmap is not modified.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

### orWith

Adds the element of the other bitmap into this bitmap.
Stores the result in this bitmap.
The provided bitmap is not modified.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

### xorWith

Computes the difference between two bitmaps.
Stores the result in this bitmap.
The provided bitmap is not modified.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

### andNotWith

Compute the difference between this and the provided bitmap,
writing the result in the current bitmap.
The provided bitmap is not modified.

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** 

### rank

Returns the number of integers that are smaller or equal to the given value.

**Parameters**

-   `value` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The value to rank

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of values smaller than the given value

### intersects

Check whether the two bitmaps intersect (have at least one element in common).

**Parameters**

-   `other` **[RoaringBitmap32](#roaringbitmap32)** The other bitmap.

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** True if the two bitmaps intersects, false if not.

### jaccardIndex

Computes the Jaccard index between two bitmaps.
(Also known as the Tanimoto distance, or the Jaccard similarity coefficient)
See <https://en.wikipedia.org/wiki/Jaccard_index>

The Jaccard index is undefined if both bitmaps are empty.

**Parameters**

-   `other`  

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The Jaccard index

### getSerializationSizeInBytesPortable

How many bytes are required to serialize this bitmap in a portable way.
The portable serialization is compatible with Java and Go versions of this library.

### serializePortable

Serializes a bitmap to a byte buffer allocated in WASM memory.
This is meant to be compatible with the Java and Go versions of the library.

The returned RoaringUint8Array is allocated in WASM memory and not garbage collected,
it need to be freed manually calling dispose().

Returns **[RoaringUint8Array](#roaringuint8array)** The RoaringUint8Array. Remember to manually dispose to free the memory.

### deserializePortable

Reads a bitmap from a serialized version.
This is meant to be compatible with the Java and Go versions of the library.
Throws an error if deserialization failed.

**Parameters**

-   `buffer` **([RoaringUint8Array](#roaringuint8array) \| [Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) \| [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>)** The containing the data to deserialize.

### getSerializationSizeInBytesNative

How many bytes are required to serialize this bitmap in a portable way.
The native serialization is compatible with the C version of the library.
Native serialization may return more compressed buffer than the portable version.

### serializeNative

Serializes a bitmap to a byte buffer allocated in WASM memory.
This is meant to be compatible with the C++ version of the library.
Can generate smaller outputs than the portable version.

The returned RoaringUint8Array is allocated in WASM memory and not garbage collected,
it need to be freed manually calling dispose().

Returns **[RoaringUint8Array](#roaringuint8array)** The RoaringUint8Array. Remember to manually dispose to free the memory.

### deserializeNative

Reads a bitmap from a serialized version.
This is meant to be compatible with the Java and Go versions of the library.
Throws an error if deserialization failed.

**Parameters**

-   `buffer` **([RoaringUint8Array](#roaringuint8array) \| [Uint8Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) \| [Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>)** The containing the data to deserialize.

## RoaringUint32Array

Array of bytes allocted directly in roaring library WASM memory.
Note: Memory is not garbage collected, you are responsible to free the allocated memory calling "dispose" method.
